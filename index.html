<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PEAK Awards</title>

  <style>
    :root{
      --bg1:#f7fbff;
      --bg2:#eef5ff;
      --ink:#111827;
      --muted:#4b5563;
      --card:#ffffffcc;
      --card2:#ffffffa6;
      --line:#d6e3ff;
      --line2:#c7d7ff;
      --gold:#c8a24a;
      --blue:#3b82f6;
      --ok:#16a34a;
      --bad:#ef4444;
      --shadow: 0 18px 55px rgba(15, 23, 42, .14);
      --shadow2: 0 10px 30px rgba(15, 23, 42, .10);
      --r: 22px;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif;
      color:var(--ink);
      background:
        radial-gradient(1200px 700px at 30% 12%, rgba(255,255,255,.95), rgba(255,255,255,0) 60%),
        radial-gradient(900px 650px at 80% 18%, rgba(219,234,254,.85), rgba(255,255,255,0) 62%),
        radial-gradient(1100px 900px at 50% 85%, rgba(226,232,240,.80), rgba(255,255,255,0) 55%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
      overflow-x:hidden;
    }

    /* fog */
    .fog{
      position:fixed; inset:-40px;
      pointer-events:none;
      filter: blur(12px);
      opacity:.85;
      background:
        radial-gradient(700px 260px at 20% 25%, rgba(255,255,255,.70), transparent 70%),
        radial-gradient(680px 240px at 80% 30%, rgba(255,255,255,.55), transparent 72%),
        radial-gradient(900px 320px at 50% 75%, rgba(255,255,255,.60), transparent 72%);
      animation: drift 16s ease-in-out infinite;
      mix-blend-mode: screen;
    }
    @keyframes drift{
      0%{ transform:translate3d(0,0,0) scale(1.02); }
      50%{ transform:translate3d(-18px,8px,0) scale(1.05); }
      100%{ transform:translate3d(0,0,0) scale(1.02); }
    }

    .wrap{
      max-width:1100px;
      margin:0 auto;
      padding:22px 16px 40px;
      position:relative;
    }

    header{
      display:flex; align-items:center; justify-content:space-between; gap:14px;
      padding:16px 18px;
      border:1px solid var(--line);
      background: linear-gradient(180deg, var(--card), var(--card2));
      border-radius: var(--r);
      box-shadow: var(--shadow2);
      backdrop-filter: blur(10px);
      position: sticky;
      top: 12px;
      z-index: 5;
    }

    .brand{
      display:flex; flex-direction:column; gap:4px;
    }
    .brand .title{
      display:flex; align-items:center; gap:10px;
      font-weight:900;
      letter-spacing:.5px;
      font-size:18px;
    }
    .crest{
      width:30px; height:30px; border-radius:12px;
      border:1px solid var(--line2);
      background:
        radial-gradient(circle at 30% 25%, #ffffff, #e6efff 60%),
        linear-gradient(180deg, #fff, #edf3ff);
      box-shadow: inset 0 0 0 2px rgba(200,162,74,.18);
      position:relative;
    }
    .crest:after{
      content:"✦";
      position:absolute; inset:0;
      display:grid; place-items:center;
      color:var(--gold);
      font-weight:900;
      text-shadow:0 6px 18px rgba(200,162,74,.25);
    }

    .brand .sub{ color:var(--muted); font-size:13px; }

    .pill{
      padding:8px 12px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.75);
      border-radius:999px;
      font-size:12px;
      color:var(--muted);
      display:flex; align-items:center; gap:8px;
      white-space:nowrap;
    }

    main{
      margin-top:16px;
      display:grid;
      grid-template-columns: 1fr 0.65fr;
      gap:14px;
    }
    @media (max-width: 980px){
      main{ grid-template-columns: 1fr; }
    }

    .panel{
      border:1px solid var(--line);
      background: linear-gradient(180deg, var(--card), var(--card2));
      border-radius: var(--r);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      padding:16px;
      overflow:hidden;
    }

    .panel h2{
      margin:0 0 10px 0;
      font-size:14px;
      letter-spacing:.25px;
      color:#0f172a;
      opacity:.9;
      display:flex; align-items:center; gap:10px;
    }
    .panel h2 .dot{
      width:10px; height:10px; border-radius:999px;
      background: radial-gradient(circle at 30% 30%, #fff, #bcd6ff);
      border:1px solid var(--line2);
      box-shadow: 0 10px 20px rgba(59,130,246,.12);
    }

    .screen{
      display:none;
      animation: pop .18s ease-out;
    }
    .screen.active{ display:block; }
    @keyframes pop{
      from{ opacity:0; transform: translateY(6px) scale(.99); }
      to{ opacity:1; transform:none; }
    }

    .hero{
      padding:18px;
      border-radius: 18px;
      border:1px solid var(--line);
      background:
        radial-gradient(900px 260px at 15% 10%, rgba(255,255,255,.92), rgba(255,255,255,0) 70%),
        linear-gradient(180deg, rgba(255,255,255,.86), rgba(255,255,255,.56));
      box-shadow: inset 0 0 0 2px rgba(200,162,74,.10);
    }
    .hero h1{
      margin:0;
      font-size:26px;
      letter-spacing:.4px;
    }
    .hero p{ margin:8px 0 0 0; color:var(--muted); }

    .row{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
    .grow{ flex:1; }

    input, select, textarea{
      width:100%;
      padding:12px 12px;
      border-radius:14px;
      border:1px solid var(--line2);
      background:rgba(255,255,255,.85);
      outline:none;
      font-size:14px;
      color:#0f172a;
    }
    input:focus, select:focus, textarea:focus{
      border-color: rgba(59,130,246,.55);
      box-shadow: 0 0 0 4px rgba(59,130,246,.12);
    }

    .btn{
      padding:12px 14px;
      border-radius:14px;
      border:1px solid rgba(59,130,246,.35);
      background: linear-gradient(180deg, #ffffff, #eef5ff);
      color:#0f172a;
      font-weight:800;
      cursor:pointer;
      transition:.14s;
      box-shadow: 0 10px 24px rgba(59,130,246,.12);
      user-select:none;
    }
    .btn:hover{ transform: translateY(-1px); }
    .btn:active{ transform: translateY(0px) scale(.99); }
    .btn.primary{
      border-color: rgba(200,162,74,.40);
      background: linear-gradient(180deg, #fff8e8, #ffffff);
      box-shadow: 0 10px 24px rgba(200,162,74,.14);
    }
    .btn.ghost{
      background: rgba(255,255,255,.55);
      box-shadow:none;
    }
    .btn.danger{
      border-color: rgba(239,68,68,.45);
      background: linear-gradient(180deg, #fff1f2, #ffffff);
      box-shadow: 0 10px 24px rgba(239,68,68,.10);
    }
    .btn:disabled{
      opacity:.55;
      cursor:not-allowed;
      transform:none;
    }

    .split{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
    }
    @media (max-width:680px){ .split{ grid-template-columns:1fr; } }

    /* Nominee cards */
    .grid{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap:10px;
    }
    @media (max-width:980px){ .grid{ grid-template-columns: repeat(2, 1fr); } }
    @media (max-width:520px){ .grid{ grid-template-columns: 1fr; } }

    .card{
      border:1px solid var(--line);
      border-radius:18px;
      background: rgba(255,255,255,.70);
      overflow:hidden;
      box-shadow: 0 12px 28px rgba(15,23,42,.10);
      cursor:pointer;
      transition:.15s;
      position:relative;
      user-select:none;
    }
    .card:hover{ transform: translateY(-2px); }
    .card.selected{
      outline: 3px solid rgba(200,162,74,.35);
      box-shadow: 0 0 0 6px rgba(200,162,74,.12), 0 16px 36px rgba(15,23,42,.12);
      transform: translateY(-2px);
    }
    .card img{
      width:100%;
      height:150px;
      object-fit:cover;
      filter: saturate(1.05) contrast(1.02);
    }
    .card .meta{
      padding:10px 12px 12px;
      display:flex; align-items:center; justify-content:space-between; gap:10px;
    }
    .name{
      font-weight:900;
      letter-spacing:.25px;
    }
    .sigil{
      font-size:14px;
      color:var(--gold);
      text-shadow:0 10px 22px rgba(200,162,74,.25);
    }

    .toast{
      margin-top:10px;
      border-radius:14px;
      padding:10px 12px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.75);
      color: var(--muted);
      display:none;
    }
    .toast.show{ display:block; animation: pop .18s ease-out; }
    .toast.ok{ border-color: rgba(22,163,74,.30); }
    .toast.bad{ border-color: rgba(239,68,68,.32); }

    .progress{
      height:10px;
      border-radius:999px;
      background: rgba(15,23,42,.08);
      border:1px solid rgba(15,23,42,.08);
      overflow:hidden;
      margin-top:10px;
    }
    .bar{
      height:100%;
      width:0%;
      background: linear-gradient(90deg, rgba(59,130,246,.65), rgba(200,162,74,.55));
      border-radius:999px;
      transition: width .25s ease;
    }

    .table{
      display:flex; flex-direction:column; gap:8px;
    }
    .rowItem{
      display:flex; align-items:center; justify-content:space-between;
      padding:10px 12px;
      border:1px solid var(--line);
      border-radius:16px;
      background: rgba(255,255,255,.72);
      box-shadow: 0 10px 22px rgba(15,23,42,.08);
    }
    .rank{
      font-weight:900;
      color: var(--gold);
      min-width:44px;
    }
    .score{
      font-weight:900;
      color:#0f172a;
    }
    .tiny{ font-size:12px; color:var(--muted); }

    .fadeIn{ animation: pop .18s ease-out; }
  </style>
</head>

<body>
  <div class="fog"></div>

  <div class="wrap">
    <header>
      <div class="brand">
        <div class="title"><span class="crest"></span> PEAK Awards</div>
        <div class="sub" id="headerSub">Голосование</div>
      </div>
      <div class="row">
        <div class="pill" id="pillStage">Stage: —</div>
        <div class="pill" id="pillProgress">—</div>
      </div>
    </header>

    <main>
      <section class="panel">
        <h2><span class="dot"></span> SCREEN</h2>

        <!-- BOOT -->
        <div class="screen active" id="scrBoot">
          <div class="hero">
            <h1>Awakening the Realm…</h1>
            <p>Белый туман, сияние герба и готовность к PEAK.</p>
            <div class="progress"><div class="bar" id="bootBar"></div></div>
            <div class="toast show" id="bootText">loading…</div>
          </div>
        </div>

        <!-- MENU -->
        <div class="screen" id="scrMenu">
          <div class="hero">
            <h1>Войти в голосование</h1>
            <p>Введи свой ник и начни выбирать “Peak” в каждой номинации.</p>
          </div>

          <div style="height:12px"></div>

          <div class="split">
            <div>
              <label class="tiny">Твой ник</label>
              <input id="voterName" placeholder="например: basuksosal" maxlength="30" />
            </div>
            <div>
              <label class="tiny">Секретный код (опционально)</label>
              <input id="passcode" placeholder="если хочешь ограничить доступ" maxlength="40" />
            </div>
          </div>

          <div style="height:10px"></div>

          <div class="row">
            <button class="btn primary" id="btnStart">Начать голосование</button>
            <button class="btn ghost" id="btnPreview">Предпросмотр номинаций</button>
          </div>

          <div class="toast" id="menuToast"></div>
        </div>

        <!-- VOTE -->
        <div class="screen" id="scrVote">
          <div class="hero">
            <h1 id="catTitle">Номинация</h1>
            <p id="catHint">Выбери одного человека.</p>
            <div class="progress"><div class="bar" id="voteBar"></div></div>
          </div>

          <div style="height:12px"></div>

          <div class="grid" id="nomineeGrid"></div>

          <div style="height:12px"></div>

          <div class="row">
            <button class="btn ghost" id="btnBack">Назад</button>
            <button class="btn primary" id="btnNext" disabled>Дальше</button>
          </div>

          <div class="toast" id="voteToast"></div>
        </div>

        <!-- REVIEW -->
        <div class="screen" id="scrReview">
          <div class="hero">
            <h1>Проверка</h1>
            <p>Вот твои выборы. Отправим их в таблицу?</p>
          </div>

          <div style="height:12px"></div>

          <div class="table" id="reviewList"></div>

          <div style="height:12px"></div>

          <div class="row">
            <button class="btn ghost" id="btnEdit">Изменить</button>
            <button class="btn primary" id="btnSend">Отправить в таблицу</button>
          </div>

          <div class="toast" id="sendToast"></div>
        </div>

        <!-- DONE -->
        <div class="screen" id="scrDone">
          <div class="hero">
            <h1>Готово ✦</h1>
            <p>Голос записан. Можно закрывать страницу.</p>
          </div>
          <div style="height:12px"></div>
          <button class="btn" id="btnAgain">Проголосовать ещё раз</button>
        </div>

      </section>

      <aside class="panel">
        <h2><span class="dot"></span> INFO</h2>

        <div class="rowItem">
          <div>
            <div class="tiny">Текущий этап</div>
            <div id="infoStage" style="font-weight:900">—</div>
          </div>
          <div class="sigil">⚔︎</div>
        </div>

        <div style="height:10px"></div>

        <div class="rowItem">
          <div>
            <div class="tiny">Голосующий</div>
            <div id="infoVoter" style="font-weight:900">—</div>
          </div>
          <div class="sigil">☁︎</div>
        </div>

        <div style="height:10px"></div>

        <div class="rowItem">
          <div>
            <div class="tiny">Прогресс</div>
            <div id="infoProg" style="font-weight:900">—</div>
          </div>
          <div class="sigil">✦</div>
        </div>

        <div style="height:14px"></div>

        <div class="hero">
          <h2 style="margin:0 0 8px 0; font-size:14px"><span class="dot"></span> Подсказка</h2>
          <p style="margin:0;color:var(--muted);font-size:13px;line-height:1.45">
            Это “PEAK Awards”: ты выбираешь одного человека в каждой номинации.
            После отправки ответ попадёт в Google Таблицу.
          </p>
        </div>

      </aside>
    </main>
  </div>

  <script>
    /* =========================================================
       1) НАСТРОЙКИ: номинации и друзья
       ========================================================= */

    // 1) НОМИНАЦИИ (можешь добавить сколько угодно)
    const CATEGORIES = [
      "Peak Aura",
      "Peak Drip",
      "Peak Humor",
      "Peak Main Character",
      "Peak IQ"
    ];

    // 2) ДРУЗЬЯ (имя + путь к фото)
    //   Положи фотки в repo: /images/...
    const NOMINEES = [
      { name: "Иван",  img: "images/ivan.jpg" },
      { name: "Маша",  img: "images/masha.jpg" },
      { name: "Саша",  img: "images/sasha.jpg" },
      { name: "Лера",  img: "images/lera.jpg" },
      { name: "Дима",  img: "images/dima.jpg" },
      { name: "Катя",  img: "images/katya.jpg" }
    ];

    /* =========================================================
       2) ОТПРАВКА В GOOGLE TABLE через GOOGLE FORM
       =========================================================
       ТЫ ЗАМЕНИШЬ ЭТО после Шага 3 (entry IDs)
       --------------------------------------------------------- */

    // A) URL формы (formResponse)
    const FORM_ACTION_URL = "PASTE_YOUR_FORM_RESPONSE_URL_HERE";

    // B) entry IDs
    // voter — поле "Кто голосует?"
    // categories — entry для каждого вопроса-номинации
    const ENTRY = {
      voter: "entry.1111111111",
      categories: {
        "Peak Aura": "entry.2222222222",
        "Peak Drip": "entry.3333333333",
        "Peak Humor": "entry.4444444444",
        "Peak Main Character": "entry.5555555555",
        "Peak IQ": "entry.6666666666"
      }
    };

    /* =========================================================
       3) ЗВУКИ (простые, но приятные)
       ========================================================= */
    let audioCtx = null;
    function ensureAudio(){
      if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      if(audioCtx.state === "suspended") audioCtx.resume();
    }
    function beep(freq=740, dur=0.05, type="sine", gain=0.03){
      try{
        ensureAudio();
        const o = audioCtx.createOscillator();
        const g = audioCtx.createGain();
        o.type = type;
        o.frequency.value = freq;
        g.gain.value = gain;
        o.connect(g); g.connect(audioCtx.destination);
        o.start();
        o.stop(audioCtx.currentTime + dur);
      }catch{}
    }
    const sClick = ()=>beep(880,0.03,"triangle",0.02);
    const sOk = ()=>{ beep(520,0.06,"triangle",0.03); setTimeout(()=>beep(780,0.08,"triangle",0.03),70); };
    const sBad = ()=>beep(220,0.10,"sawtooth",0.03);

    // активируем аудио после первого клика
    window.addEventListener("pointerdown", () => ensureAudio(), { once:true });

    /* =========================================================
       4) UI + STATE
       ========================================================= */
    const el = (id)=>document.getElementById(id);

    const scrBoot   = el("scrBoot");
    const scrMenu   = el("scrMenu");
    const scrVote   = el("scrVote");
    const scrReview = el("scrReview");
    const scrDone   = el("scrDone");

    const pillStage = el("pillStage");
    const pillProgress = el("pillProgress");

    const infoStage = el("infoStage");
    const infoVoter = el("infoVoter");
    const infoProg  = el("infoProg");

    const voterName = el("voterName");
    const passcode  = el("passcode");
    const btnStart  = el("btnStart");
    const btnPreview= el("btnPreview");
    const menuToast = el("menuToast");

    const catTitle  = el("catTitle");
    const catHint   = el("catHint");
    const nomineeGrid = el("nomineeGrid");
    const btnBack   = el("btnBack");
    const btnNext   = el("btnNext");
    const voteToast = el("voteToast");
    const voteBar   = el("voteBar");

    const reviewList= el("reviewList");
    const btnEdit   = el("btnEdit");
    const btnSend   = el("btnSend");
    const sendToast = el("sendToast");

    const btnAgain  = el("btnAgain");

    const bootBar   = el("bootBar");
    const bootText  = el("bootText");
    const headerSub = el("headerSub");

    const SCREENS = [scrBoot, scrMenu, scrVote, scrReview, scrDone];

    let state = {
      voter: "",
      catIndex: 0,
      choices: {} // { category: nomineeName }
    };

    function setStage(name){
      pillStage.textContent = `Stage: ${name}`;
      infoStage.textContent = name;
      headerSub.textContent = name;
    }
    function setProg(text){
      pillProgress.textContent = text;
      infoProg.textContent = text;
    }
    function setVoter(name){
      infoVoter.textContent = name || "—";
    }

    function showScreen(screenEl){
      SCREENS.forEach(s=>s.classList.remove("active"));
      screenEl.classList.add("active");
    }

    function toast(node, msg, type=""){
      node.className = "toast show" + (type ? " "+type : "");
      node.textContent = msg;
    }
    function hideToast(node){
      node.className = "toast";
      node.textContent = "";
    }

    /* =========================================================
       5) BOOT ANIMATION
       ========================================================= */
    function boot(){
      setStage("Boot");
      setProg("—");
      setVoter("");
      showScreen(scrBoot);

      const lines = [
        "summoning the fog…",
        "polishing the crest…",
        "preparing nominations…",
        "ready ✦"
      ];

      let i = 0;
      bootBar.style.width = "0%";
      toast(bootText, lines[0]);

      const int = setInterval(()=>{
        const pct = Math.min(100, (i+1)/lines.length * 100);
        bootBar.style.width = pct.toFixed(0) + "%";
        toast(bootText, lines[i] || "…");
        i++;

        if(i >= lines.length){
          clearInterval(int);
          setTimeout(()=>{
            showMenu();
          }, 500);
        }
      }, 500);
    }

    /* =========================================================
       6) MENU
       ========================================================= */
    function showMenu(){
      setStage("Menu");
      setProg(`${CATEGORIES.length} nominations`);
      showScreen(scrMenu);
      hideToast(menuToast);
      btnStart.disabled = false;
    }

    btnPreview.addEventListener("click", ()=>{
      sClick();
      const txt = "Номинации:\n- " + CATEGORIES.join("\n- ");
      toast(menuToast, txt);
    });

    btnStart.addEventListener("click", ()=>{
      sClick();
      const name = voterName.value.trim();
      if(!name){
        sBad();
        toast(menuToast, "Введи ник, чтобы голос был подписан.", "bad");
        return;
      }
      state.voter = name;
      state.catIndex = 0;
      state.choices = {};
      setVoter(name);
      startVoting();
    });

    /* =========================================================
       7) VOTE SCREEN
       ========================================================= */
    function startVoting(){
      setStage("Voting");
      renderCategory();
      showScreen(scrVote);
    }

    function renderCategory(){
      hideToast(voteToast);

      const cat = CATEGORIES[state.catIndex];
      catTitle.textContent = cat;
      catHint.textContent = "Выбери одного человека.";

      const done = Object.keys(state.choices).length;
      setProg(`${done}/${CATEGORIES.length}`);
      voteBar.style.width = (done / CATEGORIES.length * 100).toFixed(0) + "%";

      nomineeGrid.innerHTML = "";
      btnNext.disabled = !state.choices[cat];

      NOMINEES.forEach(n=>{
        const card = document.createElement("div");
        card.className = "card" + (state.choices[cat] === n.name ? " selected" : "");
        card.innerHTML = `
          <img src="${n.img}" alt="${n.name}" onerror="this.style.opacity=.15; this.style.filter='grayscale(1)';">
          <div class="meta">
            <div class="name">${escapeHtml(n.name)}</div>
            <div class="sigil">✦</div>
          </div>
        `;
        card.addEventListener("click", ()=>{
          sClick();
          state.choices[cat] = n.name;
          // перерендер
          renderCategory();
          btnNext.disabled = false;
        });
        nomineeGrid.appendChild(card);
      });

      btnBack.disabled = state.catIndex === 0;
    }

    btnBack.addEventListener("click", ()=>{
      sClick();
      if(state.catIndex > 0){
        state.catIndex--;
        renderCategory();
      }
    });

    btnNext.addEventListener("click", ()=>{
      sClick();
      const cat = CATEGORIES[state.catIndex];
      if(!state.choices[cat]){
        sBad();
        toast(voteToast, "Сначала выбери человека.", "bad");
        return;
      }
      if(state.catIndex < CATEGORIES.length - 1){
        state.catIndex++;
        renderCategory();
      } else {
        showReview();
      }
    });

    /* =========================================================
       8) REVIEW SCREEN
       ========================================================= */
    function showReview(){
      setStage("Review");
      setProg(`ready to send`);
      showScreen(scrReview);
      hideToast(sendToast);

      reviewList.innerHTML = "";
      CATEGORIES.forEach(cat=>{
        const who = state.choices[cat] || "—";
        const row = document.createElement("div");
        row.className = "rowItem fadeIn";
        row.innerHTML = `
          <div>
            <div style="font-weight:900">${escapeHtml(cat)}</div>
            <div class="tiny">${escapeHtml(who)}</div>
          </div>
          <div class="sigil">⚔︎</div>
        `;
        reviewList.appendChild(row);
      });
    }

    btnEdit.addEventListener("click", ()=>{
      sClick();
      setStage("Voting");
      showScreen(scrVote);
      renderCategory();
    });

    /* =========================================================
       9) SEND TO GOOGLE FORM (GOOGLE SHEET)
       ========================================================= */
    function validateFormConfig(){
      if(!FORM_ACTION_URL || FORM_ACTION_URL.includes("PASTE_")) return false;
      if(!ENTRY.voter || !ENTRY.voter.startsWith("entry.")) return false;
      for(const cat of CATEGORIES){
        const e = ENTRY.categories[cat];
        if(!e || !String(e).startsWith("entry.")) return false;
      }
      return true;
    }

    async function sendVoteToSheet(){
      // собираем данные под Google Form
      const fd = new FormData();
      fd.append(ENTRY.voter, state.voter);

      for(const cat of CATEGORIES){
        fd.append(ENTRY.categories[cat], state.choices[cat] || "");
      }

      // Важно: no-cors, потому что Google Forms не даёт CORS
      await fetch(FORM_ACTION_URL, {
        method: "POST",
        mode: "no-cors",
        body: fd
      });
    }

    btnSend.addEventListener("click", async ()=>{
      sClick();
      btnSend.disabled = true;

      if(!validateFormConfig()){
        sBad();
        toast(sendToast,
          "Нужно вставить FORM_ACTION_URL и entry.* IDs из Google Form.\nСделай Шаг 3–4.",
          "bad"
        );
        btnSend.disabled = false;
        return;
      }

      toast(sendToast, "Отправляем…");
      try{
        await sendVoteToSheet();
        sOk();
        toast(sendToast, "Отправлено ✦ Проверь Google Таблицу (вкладка Ответы).", "ok");
        setTimeout(()=>showDone(), 700);
      } catch(e){
        sBad();
        toast(sendToast, "Не получилось отправить. Попробуй ещё раз.", "bad");
        btnSend.disabled = false;
      }
    });

    function showDone(){
      setStage("Done");
      setProg("sent");
      showScreen(scrDone);
    }

    btnAgain.addEventListener("click", ()=>{
      sClick();
      // новая сессия голосования
      state.catIndex = 0;
      state.choices = {};
      showMenu();
    });

    /* =========================================================
       utils
       ========================================================= */
    function escapeHtml(s){
      return (s||"").replace(/[&<>"']/g, c => ({
        "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"
      }[c]));
    }

    /* старт */
    boot();
  </script>
</body>
</html>
