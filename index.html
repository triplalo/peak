<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>âš” PEAK âš”</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>âš”</text></svg>">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@400;700;900&family=Cinzel:wght@400;700;900&family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;0,700;1,300;1,400&display=swap" rel="stylesheet">
<script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>
<style>
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
:root{
  --bg:#d8d3c8;--bg2:#e6e1d6;--card:rgba(248,245,238,.94);
  --tx:#1a1814;--tx2:#6b6560;--ac:#8a7d6b;
  --gd:#c4a55a;--gd2:rgba(196,165,90,.15);
  --bd:#c4bfb5;--wh:#faf7f2;
  --sh:0 4px 24px rgba(0,0,0,.08);
  --sh2:0 12px 48px rgba(0,0,0,.14);
  --fd:'Cinzel Decorative',serif;
  --fh:'Cinzel',serif;
  --fb:'Cormorant Garamond',Georgia,serif;
  --danger:#a04040;
}
html{scroll-behavior:smooth}
body{font-family:var(--fb);background:var(--bg);color:var(--tx);min-height:100vh;overflow-x:hidden}
::selection{background:var(--gd2);color:var(--tx)}
::-webkit-scrollbar{width:6px}
::-webkit-scrollbar-track{background:var(--bg)}
::-webkit-scrollbar-thumb{background:var(--bd);border-radius:3px}

/* â•â•â• FOG â•â•â• */
#fog{position:fixed;inset:0;pointer-events:none;z-index:1;overflow:hidden}
#fog div{position:absolute;width:220%;height:100%}
.fg1{background:radial-gradient(ellipse at 20% 40%,rgba(255,255,255,.7) 0%,transparent 55%),radial-gradient(ellipse at 85% 20%,rgba(255,255,255,.45) 0%,transparent 50%);animation:f1 30s ease-in-out infinite}
.fg2{background:radial-gradient(ellipse at 70% 65%,rgba(255,255,255,.55) 0%,transparent 50%),radial-gradient(ellipse at 15% 15%,rgba(255,255,255,.35) 0%,transparent 45%);animation:f2 40s ease-in-out infinite}
.fg3{background:radial-gradient(ellipse at 50% 50%,rgba(235,230,218,.8) 0%,transparent 40%);animation:f3 25s ease-in-out infinite}
@keyframes f1{0%,100%{transform:translateX(0) translateY(0)}50%{transform:translateX(-14%) translateY(3%)}}
@keyframes f2{0%,100%{transform:translateX(-5%) translateY(0)}50%{transform:translateX(10%) translateY(-4%)}}
@keyframes f3{0%,100%{transform:scale(1);opacity:.2}50%{transform:scale(1.4);opacity:.6}}

/* â•â•â• VIGNETTE â•â•â• */
#vig{position:fixed;inset:0;background:radial-gradient(ellipse,transparent 40%,rgba(0,0,0,.22) 100%);pointer-events:none;z-index:2}

/* â•â•â• GRAIN â•â•â• */
body::after{content:'';position:fixed;inset:0;opacity:.03;pointer-events:none;z-index:3;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 512 512' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.8' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E");background-size:256px}

/* â•â•â• FLICKER â•â•â• */
#flicker{position:fixed;inset:0;pointer-events:none;z-index:2;animation:flk 8s ease-in-out infinite}
@keyframes flk{0%,45%,55%,100%{opacity:0}48%{opacity:.015}52%{opacity:.01}}

/* â•â•â• PARTICLES â•â•â• */
.ptc{position:fixed;inset:0;pointer-events:none;z-index:2}
.pt{position:absolute;border-radius:50%;animation:ptf linear infinite}
.pt.ash{background:rgba(160,150,135,.3)}
.pt.ember{background:rgba(196,165,90,.25);box-shadow:0 0 4px rgba(196,165,90,.2)}
@keyframes ptf{0%{transform:translateY(100vh) rotate(0) scale(1);opacity:0}5%{opacity:.7}90%{opacity:.5}100%{transform:translateY(-10vh) rotate(720deg) scale(.3);opacity:0}}

/* â•â•â• CONTENT LAYER â•â•â• */
.ctn{position:relative;z-index:10}

/* â•â•â• DIVIDER â•â•â• */
.dv{display:flex;align-items:center;gap:1rem;margin:1.5rem 0;color:var(--ac);font-size:1.1rem}
.dv::before,.dv::after{content:'';height:1px;width:100px;background:linear-gradient(to var(--d,right),transparent,var(--bd),transparent)}
.dv::after{--d:left}

/* â•â•â• ORNAMENT CORNERS â•â•â• */
.orn{position:relative}
.orn::before,.orn::after{content:'';position:absolute;width:24px;height:24px;border-style:solid;border-color:var(--gd);opacity:0;transition:opacity .4s}
.orn::before{top:10px;left:10px;border-width:2px 0 0 2px}
.orn::after{bottom:10px;right:10px;border-width:0 2px 2px 0}
.orn:hover::before,.orn:hover::after{opacity:1}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      LOGIN SCREEN
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#login{display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:100vh;text-align:center;padding:2rem}
.l-crown{font-size:3.5rem;opacity:.55;animation:crF 5s ease-in-out infinite}
@keyframes crF{0%,100%{transform:translateY(0) rotate(-2deg)}50%{transform:translateY(-10px) rotate(2deg)}}
.l-title{font-family:var(--fd);font-size:clamp(4rem,14vw,11rem);font-weight:900;letter-spacing:.18em;color:var(--tx);text-shadow:0 0 80px rgba(255,255,255,.5),0 0 140px rgba(255,255,255,.25),0 2px 0 var(--bd);animation:brth 5s ease-in-out infinite;line-height:1}
@keyframes brth{0%,100%{text-shadow:0 0 60px rgba(255,255,255,.5),0 0 120px rgba(255,255,255,.25),0 2px 0 var(--bd)}50%{text-shadow:0 0 100px rgba(255,255,255,.75),0 0 180px rgba(255,255,255,.4),0 2px 0 var(--bd)}}
.l-sub{font-family:var(--fh);font-size:clamp(.9rem,2.5vw,1.4rem);letter-spacing:.5em;text-transform:uppercase;color:var(--tx2);margin-top:.3rem}
.l-quote{max-width:450px;color:var(--tx2);font-size:1.2rem;font-style:italic;margin-bottom:2.5rem;line-height:1.7}
.l-shield{font-size:5rem;opacity:.08;position:absolute;pointer-events:none}
.l-shield:nth-child(1){top:10%;left:8%;animation:shF1 12s ease-in-out infinite}
.l-shield:nth-child(2){bottom:12%;right:8%;animation:shF2 15s ease-in-out infinite}
@keyframes shF1{0%,100%{transform:rotate(-5deg)}50%{transform:rotate(5deg)}}
@keyframes shF2{0%,100%{transform:rotate(3deg)}50%{transform:rotate(-3deg)}}

/* Buttons */
.btn-dc{display:inline-flex;align-items:center;gap:12px;padding:16px 48px;background:#5865F2;color:#fff;border:none;border-radius:6px;font-family:var(--fh);font-size:1.05rem;font-weight:700;letter-spacing:.08em;cursor:pointer;transition:all .3s;text-decoration:none;position:relative;overflow:hidden}
.btn-dc::after{content:'';position:absolute;inset:0;background:linear-gradient(135deg,transparent 40%,rgba(255,255,255,.15) 50%,transparent 60%);transform:translateX(-100%);transition:none}
.btn-dc:hover::after{transform:translateX(100%);transition:transform .6s}
.btn-dc:hover{background:#4752c4;transform:translateY(-2px);box-shadow:0 8px 32px rgba(88,101,242,.35)}
.btn-dc svg{width:22px;height:22px;fill:#fff;flex-shrink:0}
.btn-gu{display:inline-block;margin-top:1rem;padding:10px 32px;background:transparent;color:var(--tx2);border:1px solid var(--bd);border-radius:5px;font-family:var(--fh);font-size:.85rem;letter-spacing:.12em;cursor:pointer;transition:all .3s}
.btn-gu:hover{background:var(--card);color:var(--tx)}

#gbox{display:none;margin-top:1.5rem}
#gbox input{padding:12px 22px;border:1px solid var(--bd);background:var(--card);font-family:var(--fb);font-size:1.15rem;color:var(--tx);border-radius:5px;outline:none;width:280px;text-align:center;transition:border .3s}
#gbox input:focus{border-color:var(--ac)}
#gbox button{margin-top:.8rem;padding:12px 36px;background:var(--ac);color:var(--wh);border:none;font-family:var(--fh);font-size:.95rem;letter-spacing:.1em;cursor:pointer;border-radius:5px;display:block;margin-left:auto;margin-right:auto;transition:all .3s}
#gbox button:hover{background:var(--gd);transform:translateY(-1px)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        MAIN APP
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#app{display:none;min-height:100vh}
.hdr{display:flex;justify-content:space-between;align-items:center;padding:1rem 2rem;background:var(--card);border-bottom:1px solid var(--bd);backdrop-filter:blur(14px);position:sticky;top:0;z-index:100}
.hdr-b{font-family:var(--fd);font-size:1.6rem;font-weight:700;letter-spacing:.12em}
.hdr-u{display:flex;align-items:center;gap:10px}
.hdr-u img{width:36px;height:36px;border-radius:50%;border:2px solid var(--bd);object-fit:cover}
.hdr-u span{font-family:var(--fh);font-size:.92rem;font-weight:600}
.btn-o{padding:6px 16px;background:transparent;border:1px solid var(--bd);color:var(--tx2);font-family:var(--fh);font-size:.78rem;letter-spacing:.06em;cursor:pointer;border-radius:4px;transition:all .3s}
.btn-o:hover{background:var(--tx);color:var(--wh)}

/* Shield badge */
.shield{display:inline-flex;align-items:center;gap:4px;margin-left:6px;font-size:.65rem;color:#5a9a5a;font-family:var(--fh);letter-spacing:.05em;opacity:.7}
.shield svg{width:12px;height:12px;fill:#5a9a5a}

/* Tabs */
.tabs{display:flex;justify-content:center;background:var(--bg2);border-bottom:1px solid var(--bd)}
.tab{padding:1rem 2.5rem;font-family:var(--fh);font-size:.95rem;font-weight:700;letter-spacing:.15em;text-transform:uppercase;color:var(--tx2);background:transparent;border:none;border-bottom:3px solid transparent;cursor:pointer;transition:all .3s}
.tab:hover{color:var(--tx)}
.tab.on{color:var(--tx);border-bottom-color:var(--gd)}

/* Section */
.sec{max-width:1200px;margin:0 auto;padding:3rem 2rem}
.sec-t{font-family:var(--fd);font-size:2.2rem;text-align:center;margin-bottom:.4rem}
.sec-d{text-align:center;color:var(--tx2);font-size:1.2rem;font-style:italic;margin-bottom:2rem}

/* Progress */
.prg-w{max-width:420px;margin:0 auto 2.5rem;text-align:center}
.prg-t{font-family:var(--fh);font-size:.85rem;color:var(--tx2);letter-spacing:.12em;margin-bottom:.5rem}
.prg-bg{height:6px;background:var(--bd);border-radius:3px;overflow:hidden}
.prg-f{height:100%;background:linear-gradient(to right,var(--ac),var(--gd));border-radius:3px;transition:width .6s ease}

/* â•â•â• CATEGORY GRID â•â•â• */
.cgrid{display:grid;grid-template-columns:repeat(auto-fill,minmax(320px,1fr));gap:1.5rem}
.ccard{background:var(--card);border:1px solid var(--bd);border-radius:12px;padding:2rem;cursor:pointer;transition:all .4s cubic-bezier(.4,0,.2,1);position:relative;overflow:hidden}
.ccard::before{content:'';position:absolute;inset:0;background:linear-gradient(135deg,transparent 70%,rgba(196,165,90,.06));opacity:0;transition:opacity .4s}
.ccard:hover{transform:translateY(-6px);box-shadow:var(--sh2)}
.ccard:hover::before{opacity:1}
.ccard.voted{border-color:var(--gd);background:linear-gradient(135deg,var(--card),var(--gd2))}
.ccard .bv{position:absolute;top:14px;right:16px;font-family:var(--fh);font-size:.7rem;font-weight:700;letter-spacing:.12em;text-transform:uppercase;color:var(--gd);opacity:0;transition:all .4s;transform:translateY(-5px)}
.ccard.voted .bv{opacity:1;transform:translateY(0)}
.cc-i{font-size:2.8rem;margin-bottom:.6rem;display:block}
.cc-t{font-family:var(--fh);font-size:1.3rem;font-weight:700;margin-bottom:.3rem}
.cc-d{color:var(--tx2);font-size:1rem;font-style:italic}
.cc-p{margin-top:.7rem;font-family:var(--fh);font-size:.88rem;color:var(--gd);display:flex;align-items:center;gap:6px}
.cc-p img{width:22px;height:22px;border-radius:4px;object-fit:cover}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    NOMINEE BROWSER (FULL SCREEN)
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.browser{position:fixed;inset:0;z-index:2000;background:var(--bg);transform:translateY(100%);transition:transform .55s cubic-bezier(.4,0,.2,1);overflow:hidden}
.browser.open{transform:translateY(0)}
.br-head{display:flex;justify-content:space-between;align-items:center;padding:1rem 2rem;border-bottom:1px solid var(--bd);background:var(--card);backdrop-filter:blur(14px);position:relative;z-index:10}
.br-cat{display:flex;align-items:center;gap:10px}
.br-ci{font-size:2rem}
.br-ct{font-family:var(--fh);font-size:1.2rem;font-weight:700;letter-spacing:.08em}
.br-x{background:none;border:none;font-size:2.2rem;cursor:pointer;color:var(--tx2);line-height:1;transition:color .2s;padding:4px 10px}
.br-x:hover{color:var(--tx)}

.br-scroll{height:calc(100vh - 150px);overflow-y:auto;scroll-snap-type:y mandatory;-webkit-overflow-scrolling:touch;padding:1.5rem;scroll-behavior:smooth}
.br-scroll::-webkit-scrollbar{width:4px}
.br-scroll::-webkit-scrollbar-thumb{background:var(--gd);border-radius:2px}

/* Nominee slide */
.nom-s{
  scroll-snap-align:start;
  height:calc(100vh - 210px);min-height:400px;max-height:700px;
  max-width:650px;margin:0 auto 1.5rem;
  border-radius:20px;position:relative;overflow:hidden;
  cursor:pointer;transition:all .45s cubic-bezier(.4,0,.2,1);
  border:3px solid transparent;
}
.nom-s:last-child{margin-bottom:calc(100vh - 210px - 1.5rem)}
.nom-s:hover{transform:scale(1.01);box-shadow:var(--sh2)}
.nom-s.sel{border-color:var(--gd);box-shadow:0 0 0 2px var(--gd),0 0 40px rgba(196,165,90,.2),var(--sh2)}

/* Image / background */
.nom-bg{position:absolute;inset:0;background-size:cover;background-position:center;transition:transform 6s ease}
.nom-s:hover .nom-bg{transform:scale(1.05)}
.nom-grad{position:absolute;inset:0;background:linear-gradient(to top,rgba(15,13,10,.92) 0%,rgba(15,13,10,.4) 40%,rgba(15,13,10,.15) 100%)}

/* Nominee info */
.nom-info{position:absolute;bottom:0;left:0;right:0;padding:2.5rem;color:#f0ece4}
.nom-num{font-family:var(--fh);font-size:.75rem;letter-spacing:.3em;text-transform:uppercase;opacity:.5;margin-bottom:.5rem}
.nom-name{font-family:var(--fh);font-size:clamp(1.6rem,4vw,2.4rem);font-weight:900;letter-spacing:.04em;text-shadow:0 2px 8px rgba(0,0,0,.5);margin-bottom:.3rem;line-height:1.2}
.nom-sub{font-size:1.1rem;opacity:.7;font-style:italic}

/* Selection indicator */
.nom-sel{position:absolute;top:1.5rem;right:1.5rem;width:44px;height:44px;border-radius:50%;border:2px solid rgba(255,255,255,.35);display:flex;align-items:center;justify-content:center;transition:all .4s;backdrop-filter:blur(6px);background:rgba(0,0,0,.2)}
.nom-s.sel .nom-sel{border-color:var(--gd);background:var(--gd);box-shadow:0 0 20px rgba(196,165,90,.4)}
.nom-s.sel .nom-sel::after{content:'âœ“';color:#fff;font-size:1.2rem;font-weight:700}

/* Side dots */
.br-dots{position:fixed;right:1.5rem;top:50%;transform:translateY(-50%);z-index:2010;display:flex;flex-direction:column;gap:10px}
.br-dot{width:10px;height:10px;border-radius:50%;border:2px solid var(--bd);background:transparent;cursor:pointer;transition:all .3s}
.br-dot.on{background:var(--gd);border-color:var(--gd);box-shadow:0 0 8px rgba(196,165,90,.3)}

/* Bottom bar */
.br-foot{position:absolute;bottom:0;left:0;right:0;padding:1rem 2rem;background:var(--card);border-top:1px solid var(--bd);backdrop-filter:blur(14px);display:flex;justify-content:space-between;align-items:center;z-index:10}
.br-pick{font-family:var(--fh);font-size:.9rem;color:var(--tx2);letter-spacing:.08em}
.br-pick strong{color:var(--gd)}
.btn-v{padding:14px 40px;background:var(--ac);color:var(--wh);border:none;border-radius:6px;font-family:var(--fh);font-size:1rem;font-weight:700;letter-spacing:.12em;cursor:pointer;transition:all .35s;position:relative;overflow:hidden}
.btn-v:hover:not(:disabled){background:var(--gd);transform:translateY(-1px);box-shadow:0 4px 20px rgba(196,165,90,.3)}
.btn-v:disabled{opacity:.3;cursor:not-allowed}
.btn-v::after{content:'';position:absolute;inset:0;background:linear-gradient(135deg,transparent 40%,rgba(255,255,255,.2) 50%,transparent 60%);transform:translateX(-100%)}
.btn-v:hover:not(:disabled)::after{transform:translateX(100%);transition:transform .6s}

/* Vote success animation */
.vote-anim{position:fixed;inset:0;z-index:3000;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.6);backdrop-filter:blur(8px)}
.vote-anim.show{display:flex}
.va-inner{text-align:center;animation:vaIn .6s cubic-bezier(.2,1,.3,1)}
@keyframes vaIn{from{opacity:0;transform:scale(.5) translateY(30px)}to{opacity:1;transform:none}}
.va-crown{font-size:5rem;animation:vaCrown 1s ease-in-out}
@keyframes vaCrown{0%{transform:scale(0) rotate(-180deg)}60%{transform:scale(1.3) rotate(10deg)}100%{transform:scale(1) rotate(0)}}
.va-text{font-family:var(--fh);font-size:1.8rem;color:var(--wh);letter-spacing:.15em;margin-top:.5rem;text-shadow:0 0 40px rgba(196,165,90,.5)}

/* â•â•â• RESULTS â•â•â• */
#res-sec{display:none}
.rcard{background:var(--card);border:1px solid var(--bd);border-radius:12px;padding:2rem;margin-bottom:1.5rem;animation:rcIn .5s ease both}
@keyframes rcIn{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:none}}
.rc-h{display:flex;align-items:center;gap:12px;margin-bottom:1.2rem}
.rc-i{font-size:2rem}
.rc-t{font-family:var(--fh);font-size:1.25rem;font-weight:700}
.rc-tot{margin-left:auto;font-family:var(--fh);font-size:.8rem;color:var(--tx2);letter-spacing:.08em}
.rc-bars{display:flex;flex-direction:column;gap:.6rem}
.rc-row{display:flex;align-items:center;gap:10px}
.rc-img{width:36px;height:36px;border-radius:6px;object-fit:cover;border:1px solid var(--bd);flex-shrink:0}
.rc-nm{width:160px;flex-shrink:0;font-weight:600;font-size:.95rem;text-align:right}
.rc-nm .cr{margin-left:4px}
.rc-bbg{flex:1;height:28px;background:rgba(0,0,0,.04);border-radius:4px;overflow:hidden}
.rc-bar{height:100%;border-radius:4px;background:linear-gradient(to right,var(--ac),var(--ac));transition:width 1s cubic-bezier(.4,0,.2,1);min-width:3px}
.rc-bar.win{background:linear-gradient(to right,var(--gd),#d6ba62)}
.rc-cnt{width:40px;text-align:center;font-family:var(--fh);font-weight:700;font-size:.9rem;color:var(--tx2)}
.no-v{text-align:center;color:var(--tx2);font-style:italic;padding:1.5rem;font-size:1.1rem}

/* â•â•â• FOOTER â•â•â• */
.ftr{text-align:center;padding:2rem;color:var(--tx2);font-size:.9rem;font-style:italic;border-top:1px solid var(--bd);margin-top:2rem}

/* â•â•â• TOAST â•â•â• */
.toast{position:fixed;bottom:2rem;left:50%;transform:translateX(-50%) translateY(100px);background:var(--tx);color:var(--wh);padding:14px 32px;border-radius:8px;font-family:var(--fh);font-size:.92rem;letter-spacing:.06em;z-index:9999;transition:transform .4s ease;pointer-events:none}
.toast.show{transform:translateX(-50%) translateY(0)}
.toast.warn{background:var(--danger)}

/* â•â•â• ANTI-CHEAT BADGE â•â•â• */
.ac-badge{position:fixed;bottom:1rem;right:1rem;z-index:50;display:flex;align-items:center;gap:5px;padding:6px 12px;background:var(--card);border:1px solid var(--bd);border-radius:20px;font-family:var(--fh);font-size:.65rem;color:var(--tx2);letter-spacing:.08em;opacity:.5;transition:opacity .3s}
.ac-badge:hover{opacity:1}
.ac-dot{width:6px;height:6px;border-radius:50%;background:#5a9a5a;animation:acd 2s ease-in-out infinite}
@keyframes acd{0%,100%{opacity:1}50%{opacity:.3}}

/* â•â•â• RESPONSIVE â•â•â• */
@media(max-width:768px){
  .cgrid{grid-template-columns:1fr}
  .hdr{padding:.8rem 1rem;flex-wrap:wrap;gap:.4rem}
  .hdr-b{font-size:1.2rem}
  .tab{padding:.8rem 1.2rem;font-size:.78rem;letter-spacing:.1em}
  .sec{padding:2rem 1rem}
  .nom-s{height:calc(100vh - 230px);min-height:350px;border-radius:14px}
  .nom-info{padding:1.5rem}
  .br-head{padding:.8rem 1rem}
  .br-foot{padding:.8rem 1rem}
  .br-dots{right:.6rem;gap:7px}
  .br-dot{width:8px;height:8px}
  .l-title{letter-spacing:.1em}
  .btn-dc{padding:14px 28px;font-size:.95rem}
  .rc-nm{width:100px;font-size:.82rem}
  .rc-img{width:28px;height:28px}
  .nom-s:last-child{margin-bottom:0}
}
</style>
</head>

<body>
<div id="fog"><div class="fg1"></div><div class="fg2"></div><div class="fg3"></div></div>
<div id="vig"></div>
<div id="flicker"></div>

<div class="ctn">

<!-- â•â•â• LOGIN â•â•â• -->
<div id="login">
  <div class="l-shield">ğŸ›¡</div>
  <div class="l-shield">âš”</div>
  <div class="l-crown">ğŸ‘‘</div>
  <div class="l-title">PEAK</div>
  <div class="l-sub">Awards of the Year</div>
  <div class="dv">âš”</div>
  <p class="l-quote">Cast your vote.&ensp;Crown the worthy.<br>The fog will lift when the results are revealed.</p>
  <button class="btn-dc" onclick="loginDiscord()">
    <svg viewBox="0 0 24 24"><path d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0 12.64 12.64 0 0 0-.617-1.25.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057 19.9 19.9 0 0 0 5.993 3.03.078.078 0 0 0 .084-.028c.462-.63.874-1.295 1.226-1.994a.076.076 0 0 0-.041-.106 13.107 13.107 0 0 1-1.872-.892.077.077 0 0 1-.008-.128 10.2 10.2 0 0 0 .372-.292.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127 12.299 12.299 0 0 1-1.873.892.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028 19.839 19.839 0 0 0 6.002-3.03.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03zM8.02 15.33c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.956-2.419 2.157-2.419 1.21 0 2.176 1.096 2.157 2.42 0 1.333-.956 2.418-2.157 2.418zm7.975 0c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.955-2.419 2.157-2.419 1.21 0 2.176 1.096 2.157 2.42 0 1.333-.946 2.418-2.157 2.418z"/></svg>
    Enter with Discord
  </button>
  <button class="btn-gu" onclick="showGuest()">or enter as Guest</button>
  <div id="gbox">
    <input type="text" id="gname" placeholder="Thy name, traveller..." maxlength="30">
    <button onclick="loginGuest()">Enter the Hall</button>
  </div>
</div>

<!-- â•â•â• APP â•â•â• -->
<div id="app">
  <header class="hdr">
    <div class="hdr-b">âš” PEAK</div>
    <div class="hdr-u">
      <img id="uav" src="" alt="">
      <span id="unm"></span>
      <span class="shield"><svg viewBox="0 0 24 24"><path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4z"/></svg>Protected</span>
      <button class="btn-o" onclick="logout()">Leave</button>
    </div>
  </header>
  <nav class="tabs">
    <button class="tab on" data-t="vote" onclick="swTab('vote',this)">âš” Vote</button>
    <button class="tab" data-t="results" onclick="swTab('results',this)">ğŸ‘‘ Results</button>
  </nav>
  <div id="vote-sec" class="sec">
    <h2 class="sec-t">Cast Your Vote</h2>
    <p class="sec-d">Choose the peak in every category</p>
    <div class="prg-w">
      <div class="prg-t" id="prg-t">0 / 0 voted</div>
      <div class="prg-bg"><div class="prg-f" id="prg-f" style="width:0%"></div></div>
    </div>
    <div class="cgrid" id="cgrid"></div>
  </div>
  <div id="res-sec" class="sec">
    <h2 class="sec-t">The Results</h2>
    <p class="sec-d">Behold who has been crowned</p>
    <div id="res-box"></div>
  </div>
  <footer class="ftr">âš” PEAK â€” Awards of the Year âš”</footer>
</div>

</div><!-- /ctn -->

<!-- â•â•â• NOMINEE BROWSER â•â•â• -->
<div class="browser" id="browser">
  <div class="br-head">
    <div class="br-cat"><span class="br-ci" id="br-ci"></span><span class="br-ct" id="br-ct"></span></div>
    <button class="br-x" onclick="closeBrowser()">Ã—</button>
  </div>
  <div class="br-scroll" id="br-scroll"></div>
  <div class="br-dots" id="br-dots"></div>
  <div class="br-foot">
    <div class="br-pick" id="br-pick">Scroll through and select a nominee</div>
    <button class="btn-v" id="btn-v" onclick="submitVote()" disabled>Cast Your Vote</button>
  </div>
</div>

<!-- â•â•â• VOTE ANIMATION â•â•â• -->
<div class="vote-anim" id="va">
  <div class="va-inner">
    <div class="va-crown">ğŸ‘‘</div>
    <div class="va-text">Vote Recorded</div>
  </div>
</div>

<!-- â•â•â• TOAST â•â•â• -->
<div class="toast" id="toast"></div>

<!-- â•â•â• ANTI-CHEAT BADGE â•â•â• -->
<div class="ac-badge" id="acb"><div class="ac-dot"></div>Anti-Cheat Active</div>

<script>
/* â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
   â•‘            âš”  C O N F I G U R A T I O N  âš”                  â•‘
   â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

const DISCORD_CLIENT_ID = 'YOUR_CLIENT_ID_HERE';
const REDIRECT_URI = location.href.split('#')[0].split('?')[0];

const FIREBASE_CONFIG = {
  apiKey:'', authDomain:'', projectId:'',
  storageBucket:'', messagingSenderId:'', appId:''
};

/*
 *  â˜… CATEGORIES & NOMINEES â˜…
 *  Each nominee has: name, sub (subtitle), image (URL), color (fallback gradient)
 *
 *  For images â€” use any URL you want:
 *    â€¢ Steam:  https://cdn.cloudflare.steamstatic.com/steam/apps/APPID/header.jpg
 *    â€¢ Direct links to any promotional image
 *    â€¢ Leave empty '' for auto-gradient
 */
const CATEGORIES = [
  {
    id:'game', icon:'ğŸ®',
    title:'Game of the Year',
    description:'The greatest interactive experience',
    nominees:[
      {name:'Astro Bot',           sub:'Team Asobi Â· PS5',                       image:'https://cdn.cloudflare.steamstatic.com/steam/apps/2632030/header.jpg',  color:'#1a4a7a'},
      {name:'Black Myth: Wukong',  sub:'Game Science',                           image:'https://cdn.cloudflare.steamstatic.com/steam/apps/2358720/header.jpg',  color:'#8b4513'},
      {name:'Elden Ring: Shadow of the Erdtree', sub:'FromSoftware Â· DLC',       image:'https://cdn.cloudflare.steamstatic.com/steam/apps/1245620/header.jpg',  color:'#4a3a2a'},
      {name:'Final Fantasy VII Rebirth',         sub:'Square Enix',              image:'https://cdn.cloudflare.steamstatic.com/steam/apps/2909400/header.jpg',  color:'#2a3a5a'},
      {name:'Metaphor: ReFantazio',              sub:'Studio Zero Â· Atlus',      image:'https://cdn.cloudflare.steamstatic.com/steam/apps/2679460/header.jpg',  color:'#3a2a5a'}
    ]
  },
  {
    id:'movie', icon:'ğŸ¬',
    title:'Film of the Year',
    description:'The peak of cinema',
    nominees:[
      {name:'Dune: Part Two',         sub:'Denis Villeneuve',      image:'https://m.media-amazon.com/images/M/MV5BN2QyZGQ4YzctODgyYS00M2E5LWE2M2YtYzg4NGQyODkzOWM2XkEyXkFqcGc@._V1_.jpg',   color:'#c9933a'},
      {name:'Deadpool & Wolverine',   sub:'Shawn Levy Â· Marvel',   image:'https://m.media-amazon.com/images/M/MV5BZTk5ODY0MmQtMzA3Ni00NGkzLWIzN2UtYWU1NjMzZTZjMDBkXkEyXkFqcGc@._V1_.jpg',   color:'#8a1a1a'},
      {name:'Inside Out 2',           sub:'Pixar Animation',       image:'https://m.media-amazon.com/images/M/MV5BYTc1MDQ3NjAtOWEzMi00YzE1LWI2OWUtNjQ0OWJkMzI0YmVmXkEyXkFqcGc@._V1_.jpg',   color:'#e8a030'},
      {name:'The Substance',          sub:'Coralie Fargeat',       image:'https://m.media-amazon.com/images/M/MV5BYTNhYjIwYjMtZjBiYS00YTA0LTk4YzktZTI2ZWY1YTRiNDMxXkEyXkFqcGc@._V1_.jpg',   color:'#c44a80'},
      {name:'Furiosa: A Mad Max Saga',sub:'George Miller',         image:'https://m.media-amazon.com/images/M/MV5BNmZhOGU1MDctYmJiMS00Mjk0LTg5MjEtNmFjYjhjMmEzMjIyXkEyXkFqcGc@._V1_.jpg',   color:'#b87020'}
    ]
  },
  {
    id:'show', icon:'ğŸ“º',
    title:'Show of the Year',
    description:'The series that had us glued',
    nominees:[
      {name:'ShÅgun',                 sub:'FX Â· Hulu',             image:'https://m.media-amazon.com/images/M/MV5BMjE2NjYwYjUtMmY5Yi00NjRjLWI3YzMtODkxOTI4MDJhNGM4XkEyXkFqcGc@._V1_.jpg',   color:'#2a1a0a'},
      {name:'Arcane Season 2',        sub:'Riot Â· Netflix',        image:'https://m.media-amazon.com/images/M/MV5BYmU5OTczODItNTE0YS00MjdjLTliOTUtNjBjZGIyZTQxNTZlXkEyXkFqcGc@._V1_.jpg',   color:'#1a2a5a'},
      {name:'House of the Dragon S2', sub:'HBO',                   image:'https://m.media-amazon.com/images/M/MV5BOTBhOTMyOTktODdlMi00MzRjLTlhNGMtYjhiYjBhMzVmZTIwXkEyXkFqcGc@._V1_.jpg',   color:'#5a2020'},
      {name:'Fallout',                sub:'Amazon Prime Video',    image:'https://m.media-amazon.com/images/M/MV5BZGEwYmMwZmMtMTdhYi00ZWMxLTg0NzQtNTRmNzU1NWIzMjMzXkEyXkFqcGc@._V1_.jpg',   color:'#3a5a2a'},
      {name:'The Bear Season 3',      sub:'FX Â· Hulu',             image:'https://m.media-amazon.com/images/M/MV5BNDM4NzA4NDkxMl5BMl5BanBnXkFtZTgwODczMjUwMDI@._V1_.jpg',   color:'#4a3a2a'}
    ]
  },
  {
    id:'song', icon:'ğŸµ',
    title:'Song of the Year',
    description:'The track on eternal repeat',
    nominees:[
      {name:'Not Like Us',           sub:'Kendrick Lamar',         image:'https://upload.wikimedia.org/wikipedia/en/2/2c/Kendrick_Lamar_-_Not_Like_Us.png',        color:'#2a2a4a'},
      {name:'Birds of a Feather',    sub:'Billie Eilish',          image:'https://upload.wikimedia.org/wikipedia/en/0/09/Billie_Eilish_-_Birds_of_a_Feather.png',   color:'#4a7090'},
      {name:'Espresso',              sub:'Sabrina Carpenter',      image:'https://upload.wikimedia.org/wikipedia/en/2/2b/Sabrina_Carpenter_-_Espresso.png',         color:'#8a6040'},
      {name:'Beautiful Things',      sub:'Benson Boone',           image:'https://upload.wikimedia.org/wikipedia/en/f/f9/Benson_Boone_-_Beautiful_Things.png',      color:'#6a8a6a'},
      {name:'APT.',                  sub:'ROSÃ‰ & Bruno Mars',      image:'https://upload.wikimedia.org/wikipedia/en/a/a4/Ros%C3%A9_and_Bruno_Mars_-_APT..png',      color:'#aa3050'}
    ]
  },
  {
    id:'meme', icon:'ğŸ’€',
    title:'Meme of the Year',
    description:'The internet\'s finest creation',
    nominees:[
      {name:'Brainrot',              sub:'Skibidi era',             image:'',  color:'#5a3a6a'},
      {name:'Moo Deng',              sub:'The baby hippo',          image:'https://upload.wikimedia.org/wikipedia/commons/thumb/b/b2/Moo_Deng_and_Jonah_%28cropped%29.jpg/440px-Moo_Deng_and_Jonah_%28cropped%29.jpg',  color:'#6a8a5a'},
      {name:'Demure',                sub:'Very demure, very mindful', image:'',  color:'#8a7060'},
      {name:'Brat Summer',           sub:'Charli XCX energy',       image:'',  color:'#7acc00'},
      {name:'Hawk Tuah',             sub:'Spit on that thang',      image:'',  color:'#4a4a6a'}
    ]
  },
  {
    id:'moment', icon:'âš¡',
    title:'Moment of the Year',
    description:'The one we\'ll never forget',
    nominees:[
      {name:'Kendrick vs Drake',       sub:'The greatest rap beef',    image:'',  color:'#2a2a3a'},
      {name:'Trump Assassination Attempt', sub:'July 13',              image:'',  color:'#3a2a2a'},
      {name:'Oasis Reunion',           sub:'After 15 years',           image:'',  color:'#4a5a6a'},
      {name:'Imane Khelif Olympic Gold',sub:'Boxing controversy',       image:'',  color:'#c4a55a'},
      {name:'CrowdStrike Outage',      sub:'The world stopped',        image:'',  color:'#003a7a'}
    ]
  },
  {
    id:'flop', icon:'ğŸ“‰',
    title:'Biggest Flop',
    description:'The most spectacular fall from grace',
    nominees:[
      {name:'Concord',                sub:'Sony Â· $400M loss',          image:'https://cdn.cloudflare.steamstatic.com/steam/apps/2443720/header.jpg',  color:'#4a3030'},
      {name:'Joker 2',                sub:'$200M box office disaster',  image:'',  color:'#1a3a2a'},
      {name:'Suicide Squad: KTJL',    sub:'Rocksteady\'s fall',         image:'https://cdn.cloudflare.steamstatic.com/steam/apps/315210/header.jpg',   color:'#3a1a5a'},
      {name:'The Acolyte',            sub:'Cancelled after 1 season',   image:'',  color:'#2a2a4a'},
      {name:'Skull and Bones',        sub:'Ubisoft\'s $200M pirate flop', image:'https://cdn.cloudflare.steamstatic.com/steam/apps/2322560/header.jpg', color:'#2a3a5a'}
    ]
  },
  {
    id:'person', icon:'ğŸ‘‘',
    title:'Person of the Year',
    description:'The one who ruled the year',
    nominees:[
      {name:'Kendrick Lamar',          sub:'Won the culture war',      image:'https://upload.wikimedia.org/wikipedia/commons/thumb/3/32/Kendrick_Lamar_-_Lollapalooza_2023_-_2_%28cropped%29.jpg/440px-Kendrick_Lamar_-_Lollapalooza_2023_-_2_%28cropped%29.jpg',  color:'#2a2a3a'},
      {name:'Sabrina Carpenter',        sub:'Pop\'s new queen',        image:'https://upload.wikimedia.org/wikipedia/commons/thumb/c/c3/Sabrina_Carpenter_Vogue_2024.png/440px-Sabrina_Carpenter_Vogue_2024.png',  color:'#c87090'},
      {name:'TimothÃ©e Chalamet',        sub:'Dune & Wonka dominance',  image:'',  color:'#4a3a2a'},
      {name:'MrBeast',                  sub:'Most subbed YouTuber',    image:'',  color:'#2060a0'},
      {name:'Shohei Ohtani',            sub:'Baseball\'s GOAT season', image:'',  color:'#1a2a6a'}
    ]
  }
];


/* â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
   â•‘              âš”  A N T I - C H E A T  âš”                      â•‘
   â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const AC = {
  fp: null,

  getFingerprint(){
    if(this.fp) return this.fp;
    try{
      const c=document.createElement('canvas');c.width=220;c.height=60;
      const x=c.getContext('2d');
      x.textBaseline='alphabetic'; x.fillStyle='#f60'; x.fillRect(100,1,62,20);
      x.fillStyle='#069'; x.font='11pt Arial'; x.fillText('Peakâš”CrownğŸ‘‘',2,15);
      x.fillStyle='rgba(102,204,0,.7)'; x.font='18pt Arial'; x.fillText('Peakâš”CrownğŸ‘‘',4,45);
      const cd=c.toDataURL();
      const parts=[
        navigator.userAgent, navigator.language,
        screen.width+'x'+screen.height+'x'+screen.colorDepth,
        new Date().getTimezoneOffset(),
        navigator.hardwareConcurrency||'?',
        navigator.platform||'?',
        navigator.maxTouchPoints||0,
        cd.slice(-60)
      ];
      this.fp = this.hash(parts.join('|||'));
    }catch(e){
      this.fp = 'fp_'+Math.random().toString(36).substr(2,12);
    }
    return this.fp;
  },

  hash(s){
    let a=0,b=0;
    for(let i=0;i<s.length;i++){
      const c=s.charCodeAt(i);
      a=((a<<5)-a)+c; a=a&a;
      b=((b<<13)^b)+c; b=b&b;
    }
    return 'fp_'+Math.abs(a).toString(36)+Math.abs(b).toString(36);
  },

  voteHash(uid,cat,nom){
    return this.hash(uid+':'+cat+':'+nom+':peak_seal_2024');
  },

  integrityKey(uid){ return 'peak_int_'+uid; },

  checkIntegrity(uid, votes){
    const stored=localStorage.getItem(this.integrityKey(uid));
    if(!stored) return true;
    const computed=this.hash(JSON.stringify(votes)+':peak_guard');
    if(stored!==computed){
      console.warn('[âš” Peak Anti-Cheat] Tampering detected! Votes reset.');
      return false;
    }
    return true;
  },

  updateIntegrity(uid, votes){
    localStorage.setItem(this.integrityKey(uid), this.hash(JSON.stringify(votes)+':peak_guard'));
  },

  _lastVote:0,
  cooldown: 2000,
  canVote(){
    const now=Date.now();
    if(now - this._lastVote < this.cooldown){
      toast('â³ Please wait before voting again','warn');
      return false;
    }
    return true;
  },
  recordVote(){ this._lastVote = Date.now(); },

  async checkDuplicate(db,uid){
    if(!db) return true;
    try{
      const fp=this.getFingerprint();
      const snap=await db.collection('peak_votes')
        .where('fingerprint','==',fp).get();
      for(const doc of snap.docs){
        if(doc.id !== uid){
          console.warn('[âš” Peak Anti-Cheat] Duplicate fingerprint:',doc.id);
          toast('âš” Suspicious activity detected','warn');
          return false;
        }
      }
    }catch(e){}
    return true;
  }
};


/* â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
   â•‘                 âš”  M A I N   L O G I C  âš”                   â•‘
   â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let user=null, votes={}, allV={}, db=null, useFB=false;
let curCat=null, selNom=null;

// â”€â”€ Firebase â”€â”€
function initFB(){
  try{
    if(FIREBASE_CONFIG.apiKey && FIREBASE_CONFIG.projectId){
      firebase.initializeApp(FIREBASE_CONFIG);
      db=firebase.firestore(); useFB=true;
      console.log('[Peak] Firebase âœ“');
    }
  }catch(e){console.warn('[Peak] Firebase skip:',e.message)}
}

// â”€â”€ Discord Auth â”€â”€
function loginDiscord(){
  if(DISCORD_CLIENT_ID==='YOUR_CLIENT_ID_HERE'){toast('Set Discord Client ID first!','warn');return}
  location.href='https://discord.com/api/oauth2/authorize?client_id='+DISCORD_CLIENT_ID
    +'&redirect_uri='+encodeURIComponent(REDIRECT_URI)+'&response_type=token&scope=identify';
}

async function handleDiscord(){
  const h=location.hash;
  if(!h||!h.includes('access_token')) return false;
  const p=new URLSearchParams(h.substring(1));
  const tk=p.get('access_token');
  if(!tk) return false;
  try{
    const r=await fetch('https://discord.com/api/users/@me',{headers:{Authorization:'Bearer '+tk}});
    const u=await r.json();
    const av=u.avatar
      ?'https://cdn.discordapp.com/avatars/'+u.id+'/'+u.avatar+'.png?size=128'
      :'https://cdn.discordapp.com/embed/avatars/'+(parseInt(u.discriminator||'0')%5)+'.png';
    user={id:u.id,name:u.global_name||u.username,avatar:av,via:'discord'};
    sessionStorage.setItem('peak_u',JSON.stringify(user));
    history.replaceState(null,'',location.pathname+location.search);
    return true;
  }catch(e){console.error(e);return false}
}

// â”€â”€ Guest â”€â”€
function showGuest(){document.getElementById('gbox').style.display='block';document.getElementById('gname').focus()}
function loginGuest(){
  const n=document.getElementById('gname').value.trim();
  if(!n)return;
  const id='g_'+AC.getFingerprint();
  const svg='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 80 80"><rect width="80" height="80" rx="40" fill="%238a7d6b"/><text x="40" y="44" text-anchor="middle" dominant-baseline="middle" font-family="serif" font-size="34" fill="white">'+n.charAt(0).toUpperCase()+'</text></svg>';
  user={id,name:n,avatar:'data:image/svg+xml,'+encodeURIComponent(svg),via:'guest'};
  sessionStorage.setItem('peak_u',JSON.stringify(user));
  showApp();
}
function checkSession(){const s=sessionStorage.getItem('peak_u');if(s){user=JSON.parse(s);return true}return false}
function logout(){
  user=null;votes={};
  sessionStorage.removeItem('peak_u');
  document.getElementById('app').style.display='none';
  document.getElementById('login').style.display='flex';
  document.getElementById('acb').style.display='none';
}

// â”€â”€ Show App â”€â”€
function showApp(){
  document.getElementById('login').style.display='none';
  document.getElementById('app').style.display='block';
  document.getElementById('acb').style.display='flex';
  document.getElementById('unm').textContent=user.name;
  const av=document.getElementById('uav');
  if(user.avatar){av.src=user.avatar;av.style.display=''}else av.style.display='none';
  renderCards();
  loadVotes();
}

// â”€â”€ Category Cards â”€â”€
function renderCards(){
  const g=document.getElementById('cgrid');
  g.innerHTML=CATEGORIES.map((c,i)=>{
    const v=votes[c.id];
    const nom=v?c.nominees.find(n=>n.name===v):null;
    return `<div class="ccard orn${v?' voted':''}" onclick="openBrowser('${c.id}')" style="animation-delay:${i*80}ms;animation:ccIn .5s ease ${i*80}ms both">
      <span class="bv">âœ“ voted</span>
      <span class="cc-i">${c.icon}</span>
      <div class="cc-t">${c.title}</div>
      <div class="cc-d">${c.description}</div>
      ${v?`<div class="cc-p">${nom&&nom.image?`<img src="${esc(nom.image)}" onerror="this.style.display='none'" alt="">`:''}<span>Your pick: ${esc(v)}</span></div>`:''}
    </div>`;
  }).join('');
  updateProg();
}
function updateProg(){
  const t=CATEGORIES.length, d=CATEGORIES.filter(c=>votes[c.id]).length;
  document.getElementById('prg-t').textContent=d+' / '+t+' voted';
  document.getElementById('prg-f').style.width=(d/t*100)+'%';
}

// â”€â”€ Nominee Browser â”€â”€
function openBrowser(catId){
  const cat=CATEGORIES.find(c=>c.id===catId);
  if(!cat)return;
  curCat=catId;
  selNom=votes[catId]||null;

  document.getElementById('br-ci').textContent=cat.icon;
  document.getElementById('br-ct').textContent=cat.title;

  const scroll=document.getElementById('br-scroll');
  scroll.innerHTML=cat.nominees.map((n,i)=>{
    const bg=n.image
      ? `background-image:url('${esc(n.image)}')`
      : `background:${nomGrad(n.name,n.color)}`;
    const sel=selNom===n.name?' sel':'';
    return `<div class="nom-s${sel}" data-nom="${esc(n.name)}" onclick="pickNom(this)" style="animation:nsIn .5s ease ${i*120}ms both">
      <div class="nom-bg" style="${bg}" ${n.image?`onerror="this.style.background='${nomGrad(n.name,n.color)}'"`:''} ></div>
      <div class="nom-grad"></div>
      <div class="nom-sel"></div>
      <div class="nom-info">
        <div class="nom-num">Nominee ${i+1} of ${cat.nominees.length}</div>
        <div class="nom-name">${esc(n.name)}</div>
        <div class="nom-sub">${esc(n.sub)}</div>
      </div>
    </div>`;
  }).join('');

  // Handle image errors on the background divs
  scroll.querySelectorAll('.nom-bg').forEach(bg => {
    if(bg.style.backgroundImage) {
      const img = new Image();
      const url = bg.style.backgroundImage.slice(5,-2);
      img.onerror = () => {
        const card = bg.closest('.nom-s');
        const nom = CATEGORIES.find(c=>c.id===catId).nominees.find(n=>n.name===card.dataset.nom);
        bg.style.backgroundImage = 'none';
        bg.style.background = nomGrad(nom.name, nom.color);
      };
      img.src = url;
    }
  });

  // Dots
  const dots=document.getElementById('br-dots');
  dots.innerHTML=cat.nominees.map((_,i)=>`<div class="br-dot${i===0?' on':''}" onclick="scrollToNom(${i})"></div>`).join('');

  // Bottom bar
  updateBrPick();

  const btn=document.getElementById('btn-v');
  btn.disabled=!selNom;
  btn.textContent=votes[catId]?'Change Your Vote':'Cast Your Vote';

  document.getElementById('browser').classList.add('open');
  document.body.style.overflow='hidden';

  // Scroll observer
  setupScrollObs();
}

function setupScrollObs(){
  const scroll=document.getElementById('br-scroll');
  const cards=scroll.querySelectorAll('.nom-s');
  const dots=document.querySelectorAll('.br-dot');

  const obs=new IntersectionObserver(entries=>{
    entries.forEach(e=>{
      if(e.isIntersecting){
        const idx=[...cards].indexOf(e.target);
        dots.forEach((d,i)=>d.classList.toggle('on',i===idx));
      }
    });
  },{root:scroll, threshold:.6});

  cards.forEach(c=>obs.observe(c));
  scroll._obs=obs;
}

function scrollToNom(i){
  const cards=document.querySelectorAll('.nom-s');
  if(cards[i]) cards[i].scrollIntoView({behavior:'smooth',block:'start'});
}

function pickNom(el){
  document.querySelectorAll('.nom-s').forEach(s=>s.classList.remove('sel'));
  el.classList.add('sel');
  selNom=el.dataset.nom;
  document.getElementById('btn-v').disabled=false;
  updateBrPick();
  // subtle haptic
  if(navigator.vibrate) navigator.vibrate(15);
}

function updateBrPick(){
  const p=document.getElementById('br-pick');
  if(selNom) p.innerHTML='Selected: <strong>'+esc(selNom)+'</strong>';
  else p.textContent='Scroll through and select a nominee';
}

function closeBrowser(){
  const b=document.getElementById('browser');
  b.classList.remove('open');
  document.body.style.overflow='';
  const scroll=document.getElementById('br-scroll');
  if(scroll._obs){scroll._obs.disconnect();delete scroll._obs}
  curCat=null; selNom=null;
}

// â”€â”€ Submit Vote â”€â”€
async function submitVote(){
  if(!selNom||!curCat)return;
  if(!AC.canVote())return;

  // Anti-cheat: check duplicate
  if(useFB){
    const ok=await AC.checkDuplicate(db,user.id);
    if(!ok)return;
  }

  AC.recordVote();
  votes[curCat]=selNom;

  // Integrity
  AC.updateIntegrity(user.id, votes);
  localStorage.setItem('peak_v_'+user.id, JSON.stringify(votes));

  // Firebase
  if(useFB){
    try{
      const data={name:user.name, avatar:user.avatar||'', fingerprint:AC.getFingerprint(), via:user.via||'unknown'};
      CATEGORIES.forEach(c=>{if(votes[c.id])data[c.id]=votes[c.id]});
      data.updatedAt=firebase.firestore.FieldValue.serverTimestamp();
      await db.collection('peak_votes').doc(user.id).set(data,{merge:true});
    }catch(e){console.error('[Peak] FB save error',e)}
  }

  closeBrowser();

  // Show vote animation
  const va=document.getElementById('va');
  va.classList.add('show');
  // play chime
  playChime();
  setTimeout(()=>{va.classList.remove('show')},1800);

  renderCards();
}

// â”€â”€ Audio chime â”€â”€
function playChime(){
  try{
    const ctx=new(window.AudioContext||window.webkitAudioContext)();
    const notes=[523.25,659.25,783.99];
    notes.forEach((f,i)=>{
      const osc=ctx.createOscillator();
      const gain=ctx.createGain();
      osc.type='sine'; osc.frequency.value=f;
      gain.gain.setValueAtTime(0,ctx.currentTime+i*.12);
      gain.gain.linearRampToValueAtTime(.08,ctx.currentTime+i*.12+.05);
      gain.gain.exponentialRampToValueAtTime(.001,ctx.currentTime+i*.12+.6);
      osc.connect(gain); gain.connect(ctx.destination);
      osc.start(ctx.currentTime+i*.12);
      osc.stop(ctx.currentTime+i*.12+.7);
    });
  }catch(e){}
}

// â”€â”€ Load Votes â”€â”€
async function loadVotes(){
  const lv=localStorage.getItem('peak_v_'+user.id);
  if(lv){
    const parsed=JSON.parse(lv);
    if(AC.checkIntegrity(user.id,parsed)){
      votes=parsed;
    }else{
      votes={};
      localStorage.removeItem('peak_v_'+user.id);
      localStorage.removeItem(AC.integrityKey(user.id));
      toast('âš” Vote data was tampered with. Votes reset.','warn');
    }
    renderCards();
  }
  if(!useFB)return;
  try{
    const doc=await db.collection('peak_votes').doc(user.id).get();
    if(doc.exists){
      const d=doc.data();
      CATEGORIES.forEach(c=>{if(d[c.id])votes[c.id]=d[c.id]});
      localStorage.setItem('peak_v_'+user.id,JSON.stringify(votes));
      AC.updateIntegrity(user.id,votes);
      renderCards();
    }
  }catch(e){console.error('[Peak] load error',e)}
}

async function loadAllVotes(){
  allV={};
  if(useFB){
    try{
      const snap=await db.collection('peak_votes').get();
      snap.forEach(d=>{allV[d.id]=d.data()});
    }catch(e){console.error(e)}
  }
  if(user){
    if(!allV[user.id])allV[user.id]={};
    CATEGORIES.forEach(c=>{if(votes[c.id])allV[user.id][c.id]=votes[c.id]});
  }
}

// â”€â”€ Results â”€â”€
function renderResults(){
  const box=document.getElementById('res-box');
  const voters=Object.keys(allV).length;
  if(!voters){box.innerHTML='<div class="no-v">No votes have been cast yet.</div>';return}

  let html='';
  if(!useFB && voters<=1){
    html+='<div class="no-v" style="margin-bottom:1.5rem">âš” Configure Firebase to see everyone\'s votes.<br>Currently showing only your own picks.</div>';
  }

  html+=CATEGORIES.map((cat,ci)=>{
    const counts={};
    cat.nominees.forEach(n=>counts[n.name]=0);
    Object.values(allV).forEach(uv=>{
      const pick=uv[cat.id];
      if(pick && counts.hasOwnProperty(pick)) counts[pick]++;
    });
    const total=Object.values(counts).reduce((a,b)=>a+b,0);
    const max=Math.max(...Object.values(counts));
    const sorted=Object.entries(counts).sort((a,b)=>b[1]-a[1]);

    return `<div class="rcard" style="animation-delay:${ci*100}ms">
      <div class="rc-h">
        <span class="rc-i">${cat.icon}</span>
        <span class="rc-t">${cat.title}</span>
        <span class="rc-tot">${total} vote${total!==1?'s':''}</span>
      </div>
      ${total===0?'<div class="no-v">No votes yet</div>':`<div class="rc-bars">${sorted.map(([name,cnt])=>{
        const pct=total>0?(cnt/total*100):0;
        const w=cnt===max&&cnt>0;
        const nom=cat.nominees.find(n=>n.name===name);
        return `<div class="rc-row">
          ${nom&&nom.image?`<img class="rc-img" src="${esc(nom.image)}" onerror="this.style.display='none'" alt="">`:''}
          <div class="rc-nm">${esc(name)}${w?' <span class="cr">ğŸ‘‘</span>':''}</div>
          <div class="rc-bbg"><div class="rc-bar${w?' win':''}" style="width:0%" data-w="${pct}%"></div></div>
          <div class="rc-cnt">${cnt}</div>
        </div>`;
      }).join('')}</div>`}
    </div>`;
  }).join('');

  box.innerHTML=html;

  // animate bars
  requestAnimationFrame(()=>{
    setTimeout(()=>{
      document.querySelectorAll('.rc-bar[data-w]').forEach(b=>{
        b.style.width=b.dataset.w;
      });
    },100);
  });
}

// â”€â”€ Tabs â”€â”€
function swTab(t,btn){
  document.querySelectorAll('.tab').forEach(b=>b.classList.remove('on'));
  btn.classList.add('on');
  if(t==='vote'){
    document.getElementById('vote-sec').style.display='block';
    document.getElementById('res-sec').style.display='none';
  }else{
    document.getElementById('vote-sec').style.display='none';
    document.getElementById('res-sec').style.display='block';
    loadAllVotes().then(renderResults);
  }
}

// â”€â”€ Helpers â”€â”€
function esc(s){const d=document.createElement('div');d.textContent=s;return d.innerHTML}

function nomGrad(name,color){
  if(color){
    const r=parseInt(color.slice(1,3),16), g=parseInt(color.slice(3,5),16), b=parseInt(color.slice(5,7),16);
    return `linear-gradient(145deg, ${color}, rgb(${Math.max(0,r-40)},${Math.max(0,g-40)},${Math.max(0,b-40)}))`;
  }
  let h=0;for(let i=0;i<name.length;i++){h=name.charCodeAt(i)+((h<<5)-h)}
  const hue=Math.abs(h%360);
  return `linear-gradient(145deg, hsl(${hue},18%,22%), hsl(${(hue+35)%360},22%,12%))`;
}

function toast(msg,type){
  const t=document.getElementById('toast');
  t.textContent=msg;
  t.className='toast'+(type?' '+type:'');
  t.classList.add('show');
  setTimeout(()=>t.classList.remove('show'),2800);
}

// â”€â”€ Particles â”€â”€
function spawnParticles(){
  const c=document.createElement('div');c.className='ptc';c.setAttribute('aria-hidden','true');
  for(let i=0;i<40;i++){
    const p=document.createElement('div');
    const isEmber=Math.random()>.7;
    p.className='pt '+(isEmber?'ember':'ash');
    const sz=Math.random()*(isEmber?3:2.5)+1;
    Object.assign(p.style,{
      width:sz+'px',height:sz+'px',
      left:Math.random()*100+'%',
      animationDuration:(Math.random()*20+14)+'s',
      animationDelay:(Math.random()*14)+'s'
    });
    c.appendChild(p);
  }
  document.body.appendChild(c);
}

// â”€â”€ CSS Animation injection â”€â”€
function addAnimCSS(){
  const s=document.createElement('style');
  s.textContent=`
    @keyframes ccIn{from{opacity:0;transform:translateY(30px) scale(.96)}to{opacity:1;transform:none}}
    @keyframes nsIn{from{opacity:0;transform:translateY(60px) scale(.94)}to{opacity:1;transform:none}}
  `;
  document.head.appendChild(s);
}

// â”€â”€ Events â”€â”€
document.getElementById('browser').addEventListener('click',function(e){
  if(e.target===this)closeBrowser();
});
document.addEventListener('keydown',function(e){
  if(e.key==='Escape')closeBrowser();
  if(document.getElementById('browser').classList.contains('open')){
    const cards=[...document.querySelectorAll('.nom-s')];
    if(!cards.length)return;
    const scroll=document.getElementById('br-scroll');
    if(e.key==='ArrowDown'||e.key==='ArrowRight'){
      e.preventDefault();
      const dots=[...document.querySelectorAll('.br-dot')];
      const cur=dots.findIndex(d=>d.classList.contains('on'));
      if(cur<cards.length-1) scrollToNom(cur+1);
    }
    if(e.key==='ArrowUp'||e.key==='ArrowLeft'){
      e.preventDefault();
      const dots=[...document.querySelectorAll('.br-dot')];
      const cur=dots.findIndex(d=>d.classList.contains('on'));
      if(cur>0) scrollToNom(cur-1);
    }
    if(e.key==='Enter'){
      const dots=[...document.querySelectorAll('.br-dot')];
      const cur=dots.findIndex(d=>d.classList.contains('on'));
      if(cur>=0 && cards[cur]) pickNom(cards[cur]);
    }
  }
});
document.getElementById('gname').addEventListener('keypress',function(e){if(e.key==='Enter')loginGuest()});

// Detect devtools (basic deterrent)
let dtOpen=false;
const dtThreshold=160;
setInterval(()=>{
  const w=window.outerWidth-window.innerWidth>dtThreshold;
  const h=window.outerHeight-window.innerHeight>dtThreshold;
  if((w||h)&&!dtOpen){
    dtOpen=true;
    console.log('%câš” PEAK Anti-Cheat is watching âš”','font-size:20px;color:#c4a55a;font-family:serif');
  }else if(!w&&!h){dtOpen=false}
},1000);

// â”€â”€ Init â”€â”€
(async function(){
  spawnParticles();
  addAnimCSS();
  initFB();
  AC.getFingerprint();
  console.log('[âš” Peak] Fingerprint:',AC.fp);

  const dOk=await handleDiscord();
  if(dOk||checkSession()) showApp();
})();
</script>
</body>
</html>
